<!DOCTYPE html>
<html lang="zh-TW">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link href="question/jquery-ui.css" rel="stylesheet" type="text/css">
<link href="question/ui.jqgrid.css" rel="stylesheet" type="text/css">
<link href="question/jquery.multiselect.css" rel="stylesheet" type="text/css">
<link href="question/ui.multiselect.css" rel="stylesheet" type="text/css">
<link href="question/jquery.multiselect.filter.css" rel="stylesheet" type="text/css">
<link href="question/jquery.timepicker.css" rel="stylesheet" type="text/css">
<link href="question/jquery.dataTables.css" rel="stylesheet" type="text/css">
<!-- SmartMenus core CSS (required) -->
<link href="question/sm-core-css.css" rel="stylesheet" type="text/css">
<!-- "sm-blue" menu theme (optional, you can use your own CSS, too) -->
<link href="question/sm-blue.css" rel="stylesheet" type="text/css">
<link href="question/ui.dynatree.css" rel="stylesheet" type="text/css">
<!--<<link href="question/header.css" rel="stylesheet" type="text/css">
<link href="question/footer.css" rel="stylesheet" type="text/css">
link href="question/style.css" rel="stylesheet" type="text/css">-->
<!-- fullcalendar -->
<link href="question/fullcalendar.css" rel="stylesheet" type="text/css">
<link href="question/ystep.css" rel="stylesheet" type="text/css">

<!-- responsive-tabbed-navigation -->

<!-- responsive-tabbed-navigation End -->
<!-- moment for fullcalendar -->
<script src="question/moment.js" type="text/javascript"></script>
<script src="question/jquery-1.11.2.min.js" type="text/javascript"></script>
<script src="question/jquery.mb.browser.js" type="text/javascript"></script>
<script src="question/jquery-ui.min.js" type="text/javascript"></script>
<script src="question/jquery.serializejson.js" type="text/javascript"></script>
<script src="question/jquery.timepicker.min.js" type="text/javascript"></script>
<!-- <script src="js/jquery.layout.js" type="text/javascript"></script -->
<script src="question/grid.locale-tw.js" type="text/javascript"></script>
<script src="question/jquery.ui.datepicker-zh-TW.js" type="text/javascript"></script>
<!-- <script src="js/external/jquery/jquery.js" type="text/javascript"></script-->
<script src="question/jquery.jqGrid.min.js" type="text/javascript"></script>
<script src="question/jquery.tablednd.js" type="text/javascript"></script>
<!-- script src="/bms/js/plugins/jquery.contextmenu.js" type="text/javascript"></script-->
<script src="question/jquery.smartmenus.min.js" type="text/javascript"></script>

<!--script src="/bms/js/plugins/ui.multiselect.js" type="text/javascript"></script-->
<script src="question/jquery.multiselect.js" type="text/javascript"></script>
<script src="question/jquery.multiselect.filter.js" type="text/javascript"></script>
<script src="question/jquery.dataTables.js" type="text/javascript"></script>
<script src="question/jquery.twzipcode.js" type="text/javascript"></script> 
<script src="question/jquery.dynatree.js" type="text/javascript"></script>
<script src="question/jquery.validate.js" type="text/javascript"></script>
<script src="question/ohsnap.js" type="text/javascript"></script>
<script src="question/jQuery.print.js" type="text/javascript"></script>
<!-- responsive-tabbed-navigation -->
<script src="question/modernizr.js" type="text/javascript"></script>
<!-- fullcalendar -->
<script src="question/fullcalendar.js" type="text/javascript"></script>
<script src="question/lang-all.js" type="text/javascript"></script>
<script src="question/jquery.fileupload.js" type="text/javascript"></script>
<script src="question/ystep.js" type="text/javascript"></script>
<script src="question/jquery.blockUI.js" type="text/javascript"></script>
<script src="question/showMessage.js" type="text/javascript"></script>
<!--  Wacom SigCaptX script -->
<script src="question/base64.js" type="text/javascript"></script>
<script src="question/wgssSigCaptX.js" type="text/javascript"></script>

<script type="text/javascript">

$.jgrid.no_legacy_api = true;
$.jgrid.useJSON = true;
window.history.forward(1);  
</script>
<!-- sti framework script utils -->
<script src="question/sti-util.js" type="text/javascript"></script>
<!-- Google Charts -->
<script type="text/javascript" src="question/loader.js"></script>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="pragma" content="no-cache" />
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
<title>台灣血液基金會 捐血人專區 - 預約捐血 健康問卷</title>
<link rel="shortcut icon" href="favicon.ico">

<style type="text/css">
body,html{  
  margin:0px;  
  padding:0px;  
  font:12px/1.5arial;  
  height:100%;  
 }  
 #container{  
  min-height:100%;  
  position:relative;  
 }
</style>

<!-- Bootstrap -->
<link href="css/bootstrap.css" rel="stylesheet">
<link href="css/jquery-ui.css" rel="stylesheet" type="text/css">
<link href="css/style.css" rel="stylesheet" type="text/css">


<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script type="text/javascript">
(function ($, global) {

    var _hash = "!",
    noBackPlease = function () {
        global.location.href += "#";

        setTimeout(function () {
            global.location.href += "!";
        }, 50);
    };

    global.setInterval(function () {
        if (global.location.hash != _hash) {
            global.location.hash = _hash;
        }
    }, 100);

    global.onload = function () {
        noBackPlease();

        // disables backspace on page except on input fields and textarea..
        $(document.body).keydown(function (e) {
            var elm = e.target.nodeName.toLowerCase();
            if (e.which == 8 && elm !== 'input' && elm  !== 'textarea') {
                e.preventDefault();
            }
            // stopping event bubbling up the DOM tree..
            e.stopPropagation();
        });
    }

})(jQuery, window);
</script>
<script src="question/questPage.js" type="text/javascript"></script>
    
</head>
<body>
<nav id="header" class="navbar navbar-default header login">
  <div id="iconBar" class="container-fluid"> 
    <!-- Brand and toggle get grouped for better mobile display -->
    <!--<div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#defaultNavbar1"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>
      <a class="navbar-brand logo" href="index.htm"><img src="images/logo.png" width="340" height="39" alt="" class="img-responsive"/></a>
    </div>
    <div id="iconBD" class="nav navbar-nav navbar-right">
      <a class="navbar-brand icon_donate" href="index.htm"><img src="images/icon.png" width="181" height="37" alt="" class="img-responsive"/></a>
      </div>-->
    <!-- /.navbar-collapse --> 
  </div>
  <!-- /.container-fluid --> 
  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse mainMenu" id="defaultNavbar1" role="navigation">
    <!--<div class="container-fluid"> 
      <ul class="nav navbar-nav">
        <li id="btn_home" class="menu active"><a href="index.htm">首頁<span class="sr-only">(current)</span></a></li>
        <li id="btn_first" class="menu"><a href="#">首捐者請進</a></li>
        <li id="btn_registered" class="menu"><a href="#">帳號申請</a></li>
        <li id="btn_password" class="menu"><a href="#">密碼查詢</a></li>
        <li id="btn_waiting" class="last menu"><a href="#">等候人數</a></li>
      </ul>
      </div>-->
    </div>
</nav>

<div class="breadcrumbBox">
<ol class="breadcrumb">
  <li><a href="appointment.htm">預約捐血</a></li>
  <li><a href="questionnaire.htm">健康問卷</a></li>
  <li class="userInfo"><span id="donar">捐血人</span>  您好 / <a href="#" id="btn_logoutD">登出</a></li>
</ol>
</div>
<div class="container">
	<div class="row">
          <div class="col-sm-10 col-sm-offset-1 text-justify" id="commonBox">
          
          <div class="vertical-padding">
            <p>&nbsp;</p>
          </div>
          
          <p class="text-size16">說明：</p>
          <ol class="text-size16">
			  <li>捐血間隔到達前一日開放健康問卷填寫。</li>
			  <li>請於現場活動前二天內預填 (例如：10/4 舉辦捐血活動，10/2 凌晨起可以填表)，將可縮短您現場填寫電子捐血登記表時間。</li>
			  <li>捐血資格請參考台灣血液基金會網站。</li>
			  <li>此問卷填寫完畢不代表符合捐血資格，須以捐血當日面談體檢結果為主。</li>
            </ol>
          <p class="text-size16"><span class="text-warning">為保護捐血者及受血者的健康，請您務必詳閱後據實勾選，以免觸犯法律。</span><br>
            為確保血液安全，請詳閱下列現在與過去生活健康問題，並如實回答。 </p>
           <div id="container">
        <div id="contents">
        <div id="languageFieldset" style="display: none">
		<legend style="display: none">變更語系</legend>
		<table style="width: 95%">
			<tbody>
			<tr style="display: none">
				<td>
					<!-- PK -->
					<input type="text" id="pkAk" value="8494dea1f08b493fae581cfcbd4f5387">
					<input name="writer" type="hidden" id="writer" value="1">
				</td>
			</tr>
			<tr style="display: none">
				<td style="width: 30%">
					<label>語系</label>
				</td>
				<td style="width: 70%" colspan="3">
					<select id="language" name="language" style="width: 150px; display: none;" onchange="ma_chg_quest_language($(&#39;#saveForm&#39;))">
						
								<option value="TW">繁中</option>
								<option value="EN">英文</option>
							
								
							
						
					</select><button type="button" class="ui-multiselect ui-widget ui-state-default ui-corner-all" aria-haspopup="true" style="width:190px"><span class="ui-icon ui-icon-triangle-1-s"></span><span>繁中</span></button>
				</td>

			</tr>
		</tbody></table>
	</div>
<form id="saveForm" name="saveForm" method="POST" novalidate>
	<input type="button" id="saveValidateBtn" value="資料驗證" style="display: none">

</form>
			<p>&nbsp;</p>
			<p>&nbsp;</p>
</div>
</div>
          <div class="vertical-padding">
            <p>&nbsp;</p>
              <p>&nbsp;</p>
              </div>
            
            
          </div>
        
        
        
	</div>
  
  
  
</div>
<footer id="footer" class="navbar footer">
  <!--<div class="container-fluid"> 
  	<ul class="nav navbar-nav">
    	<li><a href="http://www.blood.org.tw/Internet/main/docDetail.aspx?uid=6394&pid=6392&docid=23854" target="_blank">隱私權政策</a></li>
        <li><a href="http://www.blood.org.tw/Internet/main/docDetail.aspx?uid=6395&pid=6392&docid=23858" target="_blank">服務條款</a></li>
        <li><a href="http://www.blood.org.tw/Internet/main/docDetail.aspx?uid=6396&pid=6392&docid=23855" target="_blank">資訊安全政策</a></li>
        <li><a href="http://www.blood.org.tw/Internet/main/docDetail.aspx?uid=6397&pid=6392&docid=23856" target="_blank">版權聲明</a></li>
        <li class="last"><a href="http://www.blood.org.tw/Internet/main/docDetail.aspx?uid=6398&pid=6392&docid=23853" target="_blank">聯繫方式</a></li>
    </ul>
    <div class="nav navbar-right">
    	&copy; 2016 台灣血液基金會 All Rights Reserved. Created By EDS Taiwan.
    </div>
  </div>-->
 </footer>
<script src="js/layout.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed --> 
<script src="js/bootstrap.js"></script>
<script src="js/js.cookie.js"></script>
<!--<script type="text/javascript" src="js/jquery.base64.js"></script>-->
<!--<script src="js/jquery-ui.js"></script>-->
<script type="text/javascript" src="https://font.tbsf.tw/webime/ime/arwin_loader.js"></script>
<script src="js/custom.js"></script>
<script src="js/api.js"></script>
<!--<script src="js/jquery.twzipcode-1.7.8.js"></script>-->


<script type="text/javascript">
				$(document).ready(function() {
					username();
					tkCheck();
					//
					//檢查填表當日是否可捐
					api_checkDonateIntervalReady();
					//問卷題目資料匯入
					var qa ;
					api_getQuestionaire();
					//
					$('#saveForm').submit(function(e){
						e.preventDefault();
						var validateResult = $("#saveForm").valid();
						if(!validateResult){
							return;
						}else{
							
							/*
						♂:題目與題目之間的分隔符號
						♀:題目內部資訊的分隔符號
						,:多選答案分隔符號
						*/
						/*var oo = {};
							oo.jj = $('#saveForm').serialize();
						console.log('form_data:'+JSON.stringify(oo));*/
						var form_data_ori = $('#saveForm').serialize();
						var form_data = form_data_ori.substr(0,form_data_ori.length-34); //後面34個字是同意事項
						var form_data_2 = form_data_ori.substr(form_data_ori.length-32); //同意事項
						
						var tmp = form_data.split('&');
						console.log('tmp = ',tmp);
						
						var data_string = '';
						var qa_ar = [];
						tmp.forEach(function(element){
							//console.log(element);
							
							var tmp1 = element.split('=');

							console.log('tmp1:'+tmp1);
							if(tmp1.length === 2){
								if(tmp1[0] && tmp1[1]){
									qa_ar.push(tmp1[0]);
									
								}
								
							}
							
						});
							var qa_id = qa_ar.filter(function (el, i, arr) {
								return arr.indexOf(el) === i;
							});
							console.log('qa_ar:',qa_ar);
							console.log('qa_id:',qa_id);
							//
							qa_id.forEach(function(element){
								
								console.log('element',element);
								var ans_orgcode='';
								//回答方式
								//A:下拉(單選)	
								//B:CheckBox(多選)
								//C:文數字
								//D:數字
								//E:日期
								//F:Radio(單選)
								//有選項的答案都存ORG_CODE
								var ans_way = $(('#'+element)).attr('answaycode');
								console.log('回答方式：'+ans_way);
								//
								if(ans_way === 'C' || ans_way === 'D' || ans_way === 'E')
									{
										ans_orgcode = $('[name='+element+']').val();
									}else if(ans_way === 'A' || ans_way === 'F'){
										$('[name='+element+']').each(function(index){
											if($(this).prop('checked'))
												{
													ans_orgcode += $(this).attr('orgcode');
												}
											});
									}else{
										var idx = $('[name='+element+']').length-1;
											console.log($('[name='+element+']').prop('name')+' length : '+idx);
											$('[name='+element+']').each(function(index){
												if($(this).prop('checked'))
													{
														ans_orgcode += $(this).attr('orgcode')+',';
													}
												if(idx === index)
													{
														ans_orgcode = ans_orgcode.substring(0,(ans_orgcode.length-1));
													}
											});
									}
								console.log(element+': ans_orgcode: '+ans_orgcode);
								data_string += $('#'+element).attr('orgcode') + '♀' + ans_way + '♀' + ans_orgcode + '♂';
							});
							//
							console.log(data_string);
							var ob = {};
							ob.answer = data_string;
							ob.answer2 = form_data_2;
							api_saveAnswer(ob);
							
							console.log('validateResult',validateResult);
							//var status_msg = '問卷資料傳送成功';
							//modalShow('提示', '<h3 class="text-center" style="background-image:none;"> '+status_msg+' </h3>', false, true, '繼續', 'questionnaire.htm','');	
							//modalShow(title, msg, btn_close, btn_send, btn_send_label, url, func)
						}//alert(123);
						
					});
					$("#saveForm").validate({
						ignore : [],
						errorPlacement : function(error, element) {
							element.closest('td').append('<BR>');
							element.closest('td').append(error);
						}
					});

					// 資料驗證
					$('#saveValidateBtn').click(function() {
						//var validateResult = $("#saveForm").valid();
						console.log($('#saveForm').serialize()); 
					});
					/*
					// 產生問卷頁面
					$.post("getQuestJSON", {
						pkAk : $('#pkAk').val()
					}, function(data, status) {
						console.log(data);
						
						// 轉成JSON
						ma_quest_json_all = JSON.parse(data);

						// 無啟用語系時，則不顯示"變更語系fieldset"
						if (ma_quest_json_all.isPartLang == '1') {
							$('#languageFieldset').show();
						}

						// 產生問卷頁面
						ma_gen_questPage_by_json(ma_quest_json_all, $('#saveForm'));
					});
					*/
					//var data=qa;
					//console.log(data);
					/*ma_quest_json_all = JSON.parse(data);
					if (ma_quest_json_all.isPartLang == '1') {
							$('#languageFieldset').show();
						}
					ma_gen_questPage_by_json(ma_quest_json_all, $('#saveForm'));
					$('#saveForm').append('<div class="col-xs-12" style="padding-top:50px;"><div class="col-xs-6 col-sm-3 col-sm-offset-3"><button type="submit" class="btn btn-pink center-block">填好送出</button></div><div class="col-xs-6 col-sm-3 "><button type="reset" class="btn btn-gray center-block" onclick="location.reload();">重新填寫</button></div></div>');*/
				});
			</script>
			<script>
					$("#language").multiselect({
						selectedList : 1,
						multiple : false,
					}).multiselectfilter({
						label : "",
						placeholder : "請選擇"
					});
				
				var selectNext = $("#language").next();
				if(selectNext != undefined){
					if($(selectNext).width() < 250){
						$(selectNext).attr("style","width:190px");
					}
				}
			
			</script>
			<script>
				// Multiselect元件重新整理
				function refreshMultiselect(selectElem){
					$(selectElem).multiselect().multiselect('refresh');
					var selectNext = $(selectElem).next();
					if(selectNext != undefined){
						if($(selectNext).width() < 250){
							$(selectNext).attr("style","width:190px");
						}
					}
				}
			</script>


<script>

//
$(function(){
	
});
//

</script>
</body>
</html>
